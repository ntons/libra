TARGETS=libra libra-node

.PHONY: all $(TARGETS) librad

PROXY = http://192.168.10.1:8123

BUILD_PROXY = --build-arg http_proxy=$(PROXY) --build-arg https_proxy=$(PROXY)

BUILD = docker build $(BUILD_PROXY)

all: $(TARGETS)

libra:
	$(eval TEMP := $(shell mktemp /tmp/Dockerfile.XXXX))
	FROM_IMAGE=ubuntu:18.04 ./tools/render -o $(TEMP) libra.Dockerfile
	$(BUILD) -t $@ -f $(TEMP) .
	rm -f $(TEMP)

libra-node:
	$(eval TEMP := $(shell mktemp /tmp/Dockerfile.XXXX))
	FROM_IMAGE=node:12.18 ./tools/render -o $(TEMP) libra.Dockerfile
	$(BUILD) -t $@ -f $(TEMP) .
	rm -f $(TEMP)

librad:
	$(BUILD) -t $@ -f librad.Dockerfile .

